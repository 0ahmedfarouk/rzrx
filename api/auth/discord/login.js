const C=process.env.DISCORD_CLIENT_ID; const R=process.env.DISCORD_REDIRECT_URI; export default (req,res)=>{ if(!C||!R) return res.status(500).json({error:'Missing Discord env'}); const state=Math.random().toString(36).slice(2); const u=new URL('https://discord.com/oauth2/authorize'); u.searchParams.set('client_id',C); u.searchParams.set('response_type','code'); u.searchParams.set('redirect_uri',R); u.searchParams.set('scope','identify'); u.searchParams.set('state',state); res.setHeader('Set-Cookie',`oauth_state=${state}; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=600`); res.writeHead(302,{Location:u.toString()}); res.end(); }