<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>RZRX — حسابي</title>
  <link rel="icon" href="./assets/favicon.svg"/>
  <link rel="stylesheet" href="./assets/style.css"/>
</head>
<body>
  <div class="container">
    <nav class="nav">
      <div class="brand"><span class="logo"><img src="./assets/logo.svg" width="24" height="24" alt=""/></span> RZRX</div>
      <div><a href="./index.html">الرئيسية</a> · <a href="./products.html">المتجر</a></div>
    </nav>

    <section class="card">
      <h1>حسابي</h1>
      <div id="status" class="muted"></div>
      <div class="actions">
        <button class="btn" id="login">تسجيل الدخول بـ Discord</button>
        <button class="btn" id="logout">تسجيل الخروج</button>
      </div>
    </section>

    <section class="card">
      <h2>بياناتي</h2>
      <pre id="me" class="pre"></pre>
    </section>

    <footer class="footer">© <span id="y"></span> RZRX</footer>
  </div>
  <div class="toast"></div>

  <script type="module">
    import { loginDiscord, getMe, getToken, clearToken } from './js/api.js';
    import './js/auth.js';
    import { toast } from './js/ui.js';
    import './js/config.js';

    async function refresh(){
      const t = getToken();
      const s = document.getElementById('status');
      if(!t){
        s.innerHTML = 'غير مسجل — اضغط <b>تسجيل الدخول بـ Discord</b>';
        document.getElementById('me').textContent='—';
        return;
      }
      try{
        const j = await getMe();
        s.innerHTML = 'مسجل ✅';
        document.getElementById('me').textContent = JSON.stringify(j, null, 2);
      }catch(e){
        s.innerHTML = 'جلسة غير صالحة ❌';
        document.getElementById('me').textContent='—';
      }
    }

    document.getElementById('login').onclick = ()=> loginDiscord();
    document.getElementById('logout').onclick = ()=> { clearToken(); toast('تم تسجيل الخروج'); refresh(); }

    if(location.hash.includes('login-required')){
      history.replaceState({}, '', location.pathname);
      toast('سجّل دخولك أولاً لإكمال الشراء');
    }

    refresh(); document.getElementById('y').textContent=new Date().getFullYear();
  </script>
</body>
</html>
