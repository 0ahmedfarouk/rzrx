export function getToken(){return localStorage.getItem('rzrx_token')}export function setToken(t){localStorage.setItem('rzrx_token',t)}export function clearToken(){localStorage.removeItem('rzrx_token')}export async function api(p,o={}){const h=Object.assign({'Content-Type':'application/json'},o.headers||{});const t=getToken();if(t)h.Authorization=`Bearer ${t}`;const r=await fetch(API_BASE+p,{...o,headers:h});const d=await r.json().catch(()=>({}));if(!r.ok)throw new Error(d?.error||'Request failed');return d}export const listProducts=()=>api('/api/products');export const getMe=()=>api('/api/auth/me');export const loginDiscord=()=>{location.href=`${API_BASE}/api/auth/discord/login`};export const secureBuy=(id)=>api('/api/secure/buy',{method:'POST',body:JSON.stringify({product_id:id})});export const adminCredit=(uid,delta,adm)=>api('/api/admin/credit',{method:'POST',headers:{Authorization:`Bearer ${adm}`},body:JSON.stringify({user_id:uid,delta})});